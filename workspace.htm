<html>
    <script>

    var state = 0;

    function A()
    {
        console.log('A');
    }

    function B()
    {
        console.log('B');
        setTimeout(function() { 
            console.log('BB');
            state = 1;
        }, 1000);
    }

    function C()
    {
        console.log('C');
    }

    function D()
    {
        console.log('D');
    }

    function E()
    {
        console.log('E');
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    function MyPromise(then)
    {
        this.then = then;
    }

    async function Main() {

        A();
        B();
        await sleep(2000);
        C();

        console.log('after C');

        new MyPromise(resolve => setTimeout(() => { 
                                    console.log('downloading a big picture');
                                    resolve();
                                    }, 2000)
        ).then( () => D() );

        new Promise(resolve => setTimeout(() => { 
                                    console.log('downloading second big picture');
                                    resolve();
                                    }, 2000)
        ).then( () => E() );
    }

    Main();

    </script>
</html>